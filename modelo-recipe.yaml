nome: firefox
versao: 118.0
descricao: "Mozilla Firefox Web Browser - receita ultra-completa modelo universal"

urls:
  tarball: "https://archive.mozilla.org/pub/firefox/releases/118.0/source/firefox-118.0.source.tar.xz"
  git: "https://hg.mozilla.org/mozilla-central"

sha256: "<sha256-do-tarball>"

dependencias_build:
  - autoconf2.13
  - automake
  - libtool
  - clang
  - gcc
  - rust
  - python3
  - python2
  - nodejs
  - npm
  - cbindgen
  - pkg-config
  - meson
  - ninja
  - cmake
  - cargo
  - make
  - bash
  - perl

dependencias_runtime:
  - gtk3
  - libXt
  - libevent
  - zlib
  - alsa-lib
  - ffmpeg
  - icu
  - pulseaudio
  - systemd
  - xorg-server
  - harfbuzz
  - fontconfig
  - libvpx
  - webp
  - webrtc
  - python3
  - gnome-settings-daemon
  - cairo

flags_USE:
  - pulseaudio
  - system-icu
  - ffmpeg
  - pdf
  - webgl
  - multilib
  - debug
  - doc
  - man
  - gnome
  - wayland
  - webrtc
  - sanitizer
  - hardening
  - lto
  - x11
  - wayland-backend
  - gtk3
  - clang
  - rust

tipo_build:
  - mozconfig
  - autotools
  - meson
  - cargo
  - cmake
  - python

binario_disponivel: true

patches:
  - "patches/fix-some-feature.patch"
  - "patches/compat-lib.patch"
  - "patches/enable-lto.patch"
  - "patches/wayland-support.patch"
  - "patches/enable-sanitizer.patch"
  - "patches/fix-docs.patch"

grupo: "@desktop"

hooks:
  pre_download:
    - "echo 'Preparando download do Firefox...'"
    - "mkdir -p /tmp/pm-cache"
  pre_build:
    - "echo 'Preparando build do Firefox...'"
    - "mkdir -p build_output"
    - "export CFLAGS='-O2 -pipe -fstack-protector-strong'"
  post_build:
    - "echo 'Build concluído, rodando testes...'"
    - "tail -f logs/build-firefox.log"
  post_install:
    - "echo 'Instalação concluída!'"
    - "chmod -R 755 /opt/firefox"
    - "ln -sf /opt/firefox/firefox /usr/bin/firefox"
  post_remove:
    - "echo 'Pacote removido, limpando arquivos...'"
    - "rm -rf /opt/firefox /tmp/pm-sandbox/build/firefox"

tests:
  command: "make check"
  required: true
  optional_commands:
    - "cargo test"
    - "python3 -m unittest discover tests"
